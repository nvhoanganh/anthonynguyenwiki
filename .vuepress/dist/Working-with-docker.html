<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Angular 7, .NET Core Web API with EF core,MSSQL server, VsCode, Azure DevOps CI/CD, Azure Container Service, Google Kubernetes Engine, Terraform</title>
    <meta name="description" content="">
    
    
    <link rel="preload" href="/assets/css/0.styles.616a884d.css" as="style"><link rel="preload" href="/assets/js/app.b5d32e1c.js" as="script"><link rel="preload" href="/assets/js/2.63b14787.js" as="script"><link rel="preload" href="/assets/js/30.6f8597a6.js" as="script"><link rel="prefetch" href="/assets/js/10.a42d7e20.js"><link rel="prefetch" href="/assets/js/11.bdfb7ee8.js"><link rel="prefetch" href="/assets/js/12.209db588.js"><link rel="prefetch" href="/assets/js/13.b728d991.js"><link rel="prefetch" href="/assets/js/14.c96be877.js"><link rel="prefetch" href="/assets/js/15.ffc8a3a9.js"><link rel="prefetch" href="/assets/js/16.8beb0be4.js"><link rel="prefetch" href="/assets/js/17.2295abb7.js"><link rel="prefetch" href="/assets/js/18.a1ac803e.js"><link rel="prefetch" href="/assets/js/19.2fe52198.js"><link rel="prefetch" href="/assets/js/20.a9b9e76a.js"><link rel="prefetch" href="/assets/js/21.fdb6b347.js"><link rel="prefetch" href="/assets/js/22.a15b5b15.js"><link rel="prefetch" href="/assets/js/23.945071b6.js"><link rel="prefetch" href="/assets/js/24.bb3a4332.js"><link rel="prefetch" href="/assets/js/25.8b5414db.js"><link rel="prefetch" href="/assets/js/26.926dff6b.js"><link rel="prefetch" href="/assets/js/27.9b03faa1.js"><link rel="prefetch" href="/assets/js/28.8b1b5aaa.js"><link rel="prefetch" href="/assets/js/29.1a885eda.js"><link rel="prefetch" href="/assets/js/3.23b7f5ce.js"><link rel="prefetch" href="/assets/js/31.4e9c2113.js"><link rel="prefetch" href="/assets/js/4.d34ebd53.js"><link rel="prefetch" href="/assets/js/5.bbbca69e.js"><link rel="prefetch" href="/assets/js/6.21ac9e98.js"><link rel="prefetch" href="/assets/js/7.8bddc386.js"><link rel="prefetch" href="/assets/js/8.92510434.js"><link rel="prefetch" href="/assets/js/9.da550867.js">
    <link rel="stylesheet" href="/assets/css/0.styles.616a884d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="angular-7-net-core-web-api-with-ef-core-mssql-server-vscode-azure-devops-ci-cd-azure-container-service-google-kubernetes-engine-terraform"><a href="#angular-7-net-core-web-api-with-ef-core-mssql-server-vscode-azure-devops-ci-cd-azure-container-service-google-kubernetes-engine-terraform" aria-hidden="true" class="header-anchor">#</a> Angular 7, .NET Core Web API with EF core,MSSQL server, VsCode, Azure DevOps CI/CD, Azure Container Service, Google Kubernetes Engine, Terraform</h1> <p>This is a sample project showing the steps taken to develop a simple 3 tier application using Angular 7, .NET Core Web API with EF core and MSSQL server using open Open Source development tools (VsCode) using a Windows 10 Professional laptop. Azure DevOps is used to automate the CI/CD process and deploy to both Azure Kubernetes Service and Goolge Kubernetes Engine using Terraform</p> <h2 id="step-1-install-docker-for-windows"><a href="#step-1-install-docker-for-windows" aria-hidden="true" class="header-anchor">#</a> Step 1: Install Docker for Windows</h2> <ol><li>Make sure you have Windows 10 Pro or Enterprise (Docker for Windows require Hyper-V)</li> <li>Install Docker for Windows at <a href="https://docs.docker.com/docker-for-windows/install/" target="_blank" rel="noopener noreferrer">https://docs.docker.com/docker-for-windows/install/<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>Make sure Docker is running in Linux mode</li></ol> <h2 id="step-2-create-angular-7-image"><a href="#step-2-create-angular-7-image" aria-hidden="true" class="header-anchor">#</a> Step 2: Create Angular 7 image</h2> <ol><li>install latest angular-cli using <code>npm i -g @angular/cli</code></li> <li>create new folder called <code>Docker</code> somewhere on your computer</li> <li>inside <code>Docker</code> folder create new Angular App by using <code>ng new angular-ui</code> command</li> <li>inside the <code>angular-ui</code> folder, add new file <code>nginx.conf</code> and <code>Dockerfile</code></li> <li>create new docker image by running <code>docker build --rm -f &quot;angular-ui\Dockerfile&quot; -t nvhoanganh1909/docker-demo-ui:latest angular-ui</code> command from the root folder. <strong>Note</strong>:
<ol><li><code>nvhoanganh1909</code> is your Docker Hub username.</li> <li><code>docker-demo-ui</code> is the name of the image</li> <li><code>:latest</code> is the tag or the version number of the image.</li></ol></li> <li>check to make sure image is created by running <code>docker images</code> command</li> <li>run the newly created image by running <code>docker run -d --rm -p 4200:80 nvhoanganh1909/docker-demo-ui:latest</code> where</li> <li>open http://localhost:4200 , you should see the Angular app is running</li></ol> <p><strong>Note</strong>:</p> <ul><li>view the running docker container by running <code>docker ps</code></li> <li>stop the running container by running <code>docker container stop 0f</code> where <code>0f</code> is the first 2 characters of the Container ID</li> <li>run <code>docker system prune --volumes -f</code> to remove all unused images and containers</li></ul> <h2 id="step-3-create-microsoft-sql-server-container-image"><a href="#step-3-create-microsoft-sql-server-container-image" aria-hidden="true" class="header-anchor">#</a> Step 3: Create Microsoft SQL Server Container Image</h2> <ol><li>login to <a href="https://hub.docker.com/" target="_blank" rel="noopener noreferrer">https://hub.docker.com/<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>search for <code>microsoft SQL linux</code></li> <li>select <a href="https://hub.docker.com/r/microsoft/mssql-server-linux/" target="_blank" rel="noopener noreferrer">https://hub.docker.com/r/microsoft/mssql-server-linux/<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>check instructions on how to use this image</li> <li>now pull down the latest version of this image by running <code>docker pull microsoft/mssql-server-linux:latest</code></li> <li>start the container using SQLExpress mode by running <code>docker run -e 'ACCEPT_EULA=Y' -e 'SA_PASSWORD=Password1' -e 'MSSQL_PID=Express' -p 1433:1433 -d microsoft/mssql-server-linux:latest</code> (change <code>SA_PASSWORD</code> to something else)</li> <li>you now can connect to this SQL server using SQL Management Studio</li></ol> <h2 id="step-4-create-new-net-core-webapi"><a href="#step-4-create-new-net-core-webapi" aria-hidden="true" class="header-anchor">#</a> Step 4: Create new .NET Core WebApi</h2> <ol><li>from the root folder (<code>Docker</code>), create new folder called <code>dotnetcore-api</code> using <code>mkdir dotnetcore-webapi</code></li> <li>cd into the <code>dotnetcore-webapi</code> and run <code>dotnet new webapi</code></li> <li>edit <code>dotnetcore-webapi.csproj</code> and add <code>&lt;DockerDefaultTargetOS&gt;Linux&lt;/DockerDefaultTargetOS&gt;</code> element under <code>&lt;TargetFramework&gt;netcoreapp2.1&lt;/TargetFramework&gt;</code> element.</li> <li>in the dotnetcore-webapi folder create <code>Dockerfile</code> and <code>.dockerignore</code> file</li> <li>Build the docker image by running <code>docker build --rm -f &quot;dotnetcore-webapi\Dockerfile&quot; -t nvhoanganh1909/docker-demo-user-api:latest dotnetcore-webapi</code> from the root folder</li> <li>now run the webapi by running <code>docker run -d -p 8080:80 nvhoanganh1909/docker-demo-user-api</code></li> <li>open http://localhost:8080/api/values and you should be able to see the response from the API</li></ol> <h2 id="step-5-create-new-net-core-api-gateway-using-ocelot"><a href="#step-5-create-new-net-core-api-gateway-using-ocelot" aria-hidden="true" class="header-anchor">#</a> Step 5: Create new .NET Core Api Gateway using Ocelot</h2> <ol><li>from the root folder (<code>Docker</code>), create new folder called <code>api-gateway</code></li> <li>cd into the <code>api-gateway</code> and run <code>dotnet new webapi</code></li> <li>add <code>ocelot</code> nuget package</li> <li>modify <code>Startup.cs</code> and <code>Program.cs</code> accordingly</li></ol> <p><strong>NOTE</strong>:</p> <ul><li>Ocelot uses information stored in <code>configuration.json</code> to route requests to the correct API. During development the configuration.json file under <code>api-gateway\configuration</code></li> <li>When we deploy the app, we will use Volume mapping to replace this file with the correct config file</li></ul> <h2 id="step-6-wiring-up-connections-between-containers"><a href="#step-6-wiring-up-connections-between-containers" aria-hidden="true" class="header-anchor">#</a> Step 6: Wiring up connections between containers</h2> <p>In this step, we will add a simple User management functionality to our system using ASP .NET Identity.</p> <ol><li>Add ASP .NET Identity using SQL <a href="https://docs.microsoft.com/en-us/aspnet/core/security/authentication/identity?view=aspnetcore-2.2&amp;tabs=visual-studio" target="_blank" rel="noopener noreferrer">See Instructions<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>Add Data Seeder to create 1 user called <strong>admin</strong></li> <li>Create <code>UsersController.cs</code> which expose CRUD REST endpoints at http://localhost/api/user</li> <li>Modify Angular UI which call the api gateway and return the list of users (calling http://localhost/api/u/users)</li> <li>Now if you run all 3 apps at the same time (Web API + Ocelot API Gateway + Angular) you should be the app running</li></ol> <h2 id="step-7-run-the-whole-app-using-docker-compose-file"><a href="#step-7-run-the-whole-app-using-docker-compose-file" aria-hidden="true" class="header-anchor">#</a> Step 7: Run the whole app using Docker-compose file</h2> <ol><li>go to the root level (<code>Docker</code> folder) and create new file called <code>docker-compose.yml</code>. This file describe how containers are started and stopped</li> <li>run <code>docker-compose up</code> to run the app</li> <li>run <code>docker-compose down</code> to shut down the app</li></ol> <h2 id="step-8-pushing-images-to-docker-hub"><a href="#step-8-pushing-images-to-docker-hub" aria-hidden="true" class="header-anchor">#</a> Step 8: Pushing images to Docker Hub</h2> <ol><li>Login to docker hub by running <code>docker login -u nvhoanganh1909</code></li> <li>Tag the local image <code>docker tag f16 nvhoanganh1909/docker-demo-ui:latest</code> where <code>f16</code> is the first 3 characters of your imagek</li> <li>Push the newly tagged image <code>docker push nvhoanganh1909/docker-demo-ui:latest</code></li> <li>Login to https://hub.docker.com/ and make sure you can see the new docker image</li></ol> <h2 id="step-9-add-kubernetes"><a href="#step-9-add-kubernetes" aria-hidden="true" class="header-anchor">#</a> Step 9: Add Kubernetes</h2> <ol><li>From Docker for Windows Settings, turn on Kubernetes option</li> <li>Verify Kubenetes is running by running <code>kubectl cluster-info</code> command</li> <li>Create new K8s namespace (<a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/namespaces/" target="_blank" rel="noopener noreferrer">k8s-namespace<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>) by running <code>kubectl create namespace dev</code></li> <li>Register user context by running <code>kubectl config set-context dev --namespace=dev --cluster=docker-for-desktop-cluster --user=docker-for-desktop</code></li> <li>Switch to dev context <code>kubectl config use-context dev</code></li> <li>Create ConfigMap <code>$ kubectl.exe create configmap webbffconfigmap --from-file=./src/api-gateway/web.bff/config/configuration.json</code></li> <li>Install <code>nginx ingress controller</code> by running <code>kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/master/deploy/mandatory.yaml</code> then run <code>kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/master/deploy/provider/cloud-generic.yaml</code></li> <li>Create resources defined in the <code>k8s.yml</code> in <code>dev</code> context by running <code>kubectl apply -f k8s.yml --record</code></li> <li>Run <code>kubectl get all</code> ande make sure all services and pods are running</li> <li>Browse http://localhost/ and make sure you can see the app running</li> <li>At anytime you can run <code>kubectl delete daemonsets,replicasets,services,deployments,pods,rc --all --namespace=dev</code> to remove all created resources in the dev namespace</li></ol> <p><strong>Notes</strong>:</p> <ul><li>get current rollout update status <code>kubectl.exe rollout status deployments webui-deployment</code></li> <li>get Deployment history  <code>kubectl.exe rollout history deployments webui-deployment</code></li> <li>check current deployment details <code>kubectl.exe describe deploy webui-deployment</code></li> <li>to roll back <code>kubectl.exe rollout undo deployment webui-deployment --to-revision=1</code></li> <li>run Bash command inside a pod <code>kubectl.exe exec apigw-pod -i -t -- bash</code></li></ul> <h2 id="step-10-manually-deploy-to-azure-aks"><a href="#step-10-manually-deploy-to-azure-aks" aria-hidden="true" class="header-anchor">#</a> Step 10: Manually deploy to Azure AKS</h2> <h3 id="part-1-set-up-aks-cluster"><a href="#part-1-set-up-aks-cluster" aria-hidden="true" class="header-anchor">#</a> Part 1. set up AKS Cluster</h3> <ol><li>create new AKS via Azure Portal</li> <li>download and install Azure CLI</li> <li>switch context to AKS <code>az aks get-credentials --resource-group dockertest --name dockerdemo</code> where <code>dockertest</code> is the resource group name and <code>dockerdemo</code> is the name of your AKS cluster</li> <li>install <a href="https://docs.helm.sh/using_helm/#quickstart-guide" target="_blank" rel="noopener noreferrer">Helm<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> and add to your PATH</li> <li>make sure current context for kubectl is your Azure AKS by running <code>kubectl.exe config current-context</code> and <code>kubectl.exe config use-context dockerdemo</code> to switch to the correct context</li> <li>run (in Git Bash)</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code>helm init
kubectl create serviceaccount --namespace kube-system tiller
kubectl create clusterrolebinding tiller-cluster-rule --clusterrole<span class="token operator">=</span>cluster-admin --serviceaccount<span class="token operator">=</span>kube-system:tiller
kubectl patch deploy --namespace kube-system tiller-deploy -p <span class="token string">'{&quot;spec&quot;:{&quot;template&quot;:{&quot;spec&quot;:{&quot;serviceAccount&quot;:&quot;tiller&quot;}}}}'</span>
</code></pre></div><h3 id="part-2-install-istio"><a href="#part-2-install-istio" aria-hidden="true" class="header-anchor">#</a> Part 2: Install Istio</h3> <ol><li>install Istio using Helm https://istio.io/docs/setup/kubernetes/helm-install/</li></ol> <h3 id="part-2-create-staging-and-prod-namespace"><a href="#part-2-create-staging-and-prod-namespace" aria-hidden="true" class="header-anchor">#</a> Part 2: Create Staging and Prod namespace</h3> <ol><li>run <code>kubectl.exe create ns staging</code> and <code>kubectl.exe create ns prod</code></li> <li>create new staging and prod context <code>kubectl config set-context dockerdemo-staging --namespace=staging --cluster=dockerdemo --user=clusterUser_dockertest_dockerdemo</code> and <code>kubectl config set-context dockerdemo-prod --namespace=prod --cluster=dockerdemo --user=clusterUser_dockertest_dockerdemo</code></li></ol> <h3 id="part-3-create-the-app-on-staging-and-prod"><a href="#part-3-create-the-app-on-staging-and-prod" aria-hidden="true" class="header-anchor">#</a> Part 3: Create the app on staging and prod</h3> <ol><li>change context to dockerdemo-staging <code>kubectl config use-context dockerdemo-staging</code></li> <li>Create ConfigMap <code>$ kubectl.exe create configmap webbffconfigmap --from-file=./src/api-gateway/web.bff/config/configuration.json</code></li> <li>run <code>kubectl.exe apply -f k8s.yml -f k8s.staging.yml --record</code></li> <li>wait for deployment to be completed and navigate to http://staging.52.187.236.54.xip.io/. You should see the app is now running in Azure AKS</li> <li>Repate the step above for prod</li></ol> <p><strong>Note</strong>:</p> <ul><li>try to delete the Prod or Staging deployment by running <code>kubectl.exe delete -f k8s.yml</code></li> <li>re-run <code>kubectl.exe apply -f k8s.yml -f k8s.prod.yml --record</code></li></ul> <h2 id="step-11-make-changes-to-angular-ui-app"><a href="#step-11-make-changes-to-angular-ui-app" aria-hidden="true" class="header-anchor">#</a> Step 11: Make changes to Angular UI app</h2> <p>Let's make a small change to the app</p> <ul><li>switch context to dev <code>kubectl.exe config use-context dev</code></li> <li>make sure our app is running at http://localhost (if not ,just run <code>kubectl.exe apply -f k8s.yml --record</code>)</li> <li>run <code>ng s</code> inside <code>angular-ui</code> folder</li> <li>now the angular app running at http://locahost:4200 will use the api running in the local Dev cluster (http://localhost/api)</li> <li>make the change you want to the angular app</li> <li>build new image <code>docker build --rm -f &quot;angular-ui\Dockerfile&quot; -t nvhoanganh1909/docker-demo-ui:4 angular-ui</code> where <code>4</code> is the new versio number</li> <li>update k8s.yml file with the new image number <code>image: nvhoanganh1909/docker-demo-ui:4</code></li> <li>run <code>kubectl.exe apply -f k8s.yml --record</code></li> <li>make sure new version is running at http://localhost</li> <li>push new image to Docker hub <code>docker push nvhoanganh1909/docker-demo-ui:4</code></li> <li>switch context to <code>kubectl.exe config use-context dockerdemo-staging</code></li> <li>deploy new chages to Staging by running <code>kubectl.exe apply -f k8s.yml --record</code></li> <li>now go to http://staging.52.187.236.54.xip.io/ and you should see the new version is running</li> <li>check http://prod.52.187.236.54.xip.io/ and you should see the old version is still running</li></ul> <h2 id="step-12-manually-deploy-to-google-kubernetes-engine"><a href="#step-12-manually-deploy-to-google-kubernetes-engine" aria-hidden="true" class="header-anchor">#</a> Step 12: Manually Deploy to Google Kubernetes Engine</h2> <p>Now we will deploy the same app above to Google Cloud</p> <h3 id="part-1-set-up-gke-cluster-with-static-ip-using-helm"><a href="#part-1-set-up-gke-cluster-with-static-ip-using-helm" aria-hidden="true" class="header-anchor">#</a> Part 1. set up GKE Cluster with static IP using HELM</h3> <ul><li>Create new Google Cloud app at https://console.cloud.google.com/projectcreate , call it dockerdemo</li> <li>Create new K8s Cluster https://console.cloud.google.com/kubernetes/add?project=dockerdemo-227313&amp;template=your-first-cluster where dockerdemo-227313 is the newly created project Id</li> <li>download <code>gcloud.exe</code> from https://cloud.google.com/sdk/docs/#install_the_latest_cloud_tools_version_cloudsdk_current_version</li> <li>run <code>gcloud container clusters get-credentials your-first-cluster-1 --zone asia-east1-a --project dockerdemo-227313</code></li> <li>view list of contexts <code>kubectl.exe config view</code></li> <li>switch to the correct context <code>kubectl.exe config use-context gke_dockerdemo-227313_asia-east1-a_your-first-cluster-1</code></li> <li>create static Ip <code>gcloud compute addresses create dockerdemo-ip --global</code> (note, ip name must be lower case)</li> <li>get the ip address <code>gcloud compute addresses describe dockerdemo-ip --global</code></li> <li>run the following 3 commands</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code>helm init
kubectl create serviceaccount --namespace kube-system tiller
kubectl create clusterrolebinding tiller-cluster-rule --clusterrole<span class="token operator">=</span>cluster-admin --serviceaccount<span class="token operator">=</span>kube-system:tiller
kubectl patch deploy --namespace kube-system tiller-deploy -p <span class="token string">'{&quot;spec&quot;:{&quot;template&quot;:{&quot;spec&quot;:{&quot;serviceAccount&quot;:&quot;tiller&quot;}}}}'</span>
</code></pre></div><h3 id="part-2-create-staging-and-prod-namespace-2"><a href="#part-2-create-staging-and-prod-namespace-2" aria-hidden="true" class="header-anchor">#</a> Part 2: Create Staging and Prod namespace</h3> <ol><li>run <code>kubectl.exe create ns staging</code> and <code>kubectl.exe create ns prod</code></li> <li>create new staging and prod context <code>kubectl config set-context gke-dockerdemo-staging --namespace=staging --cluster=gke_dockerdemo-227313_asia-east1-a_your-first-cluster-1 --user=gke_dockerdemo-227313_asia-east1-a_your-first-cluster-1</code> and <code>kubectl config set-context gke-dockerdemo-prod --namespace=prod --cluster=gke_dockerdemo-227313_asia-east1-a_your-first-cluster-1 --user=gke_dockerdemo-227313_asia-east1-a_your-first-cluster-1</code></li></ol> <h3 id="part-3-create-the-app-on-staging-and-prod-2"><a href="#part-3-create-the-app-on-staging-and-prod-2" aria-hidden="true" class="header-anchor">#</a> Part 3: Create the app on staging and prod</h3> <ol><li>change context to gke-dockerdemo-staging <code>kubectl config use-context gke-dockerdemo-staging</code></li> <li>Create ConfigMap <code>$ kubectl.exe create configmap webbffconfigmap --from-file=./src/api-gateway/web.bff/config/configuration.json</code></li> <li>run <code>kubectl.exe apply -f k8s.yml -f k8s.staging.gke.yml --record</code></li> <li>wait for deployment to be completed and navigate to http://staging.35.241.14.155.xip.io/. You should see the app is now running in Azure AKS</li> <li>Repate the step above for prod</li></ol> <h2 id="step-13-automate-ci-cd-using-azure-devops"><a href="#step-13-automate-ci-cd-using-azure-devops" aria-hidden="true" class="header-anchor">#</a> Step 13: Automate CI/CD using Azure DevOps</h2> <h2 id="step-12-deploy-to-azure-container-service-and-google-kubernetes-engine-using-terraform"><a href="#step-12-deploy-to-azure-container-service-and-google-kubernetes-engine-using-terraform" aria-hidden="true" class="header-anchor">#</a> Step 12: Deploy to Azure Container Service and Google Kubernetes Engine using Terraform</h2> <p>https://www.hanselman.com/blog/HowToSetUpKubernetesOnWindows10WithDockerForWindowsAndRunASPNETCore.aspx</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.b5d32e1c.js" defer></script><script src="/assets/js/2.63b14787.js" defer></script><script src="/assets/js/30.6f8597a6.js" defer></script>
  </body>
</html>
